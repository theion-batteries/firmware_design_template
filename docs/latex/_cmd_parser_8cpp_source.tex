\hypertarget{_cmd_parser_8cpp_source}{}\doxysection{Cmd\+Parser.\+cpp}
\label{_cmd_parser_8cpp_source}\index{C:/Users/SamiDhiab/Theion\_Repos/firmware\_design\_template/src/CmdParser.cpp@{C:/Users/SamiDhiab/Theion\_Repos/firmware\_design\_template/src/CmdParser.cpp}}
\mbox{\hyperlink{_cmd_parser_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00001}00001 \textcolor{comment}{/* Copyright 2016 Pascal Vizeli <pvizeli@syshack.ch>}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00002}00002 \textcolor{comment}{ * BSD License}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00003}00003 \textcolor{comment}{ *}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00004}00004 \textcolor{comment}{ * https://github.com/pvizeli/CmdParser}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00005}00005 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00006}00006 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00007}00007 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_cmd_parser_8hpp}{CmdParser.hpp}}"{}}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00008}00008 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00009}\mbox{\hyperlink{class_cmd_parser_a2ea6dfe5c12c9effc1419764e46e076e}{00009}} \mbox{\hyperlink{class_cmd_parser_a2ea6dfe5c12c9effc1419764e46e076e}{CmdParser::CmdParser}}()}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00010}00010     : m\_ignoreQuote(false),}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00011}00011       m\_useKeyValue(false),}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00012}00012       m\_seperator(\mbox{\hyperlink{_cmd_parser_8hpp_a94a8be72182a06b2748afa109c831ab5}{CMDPARSER\_CHAR\_SP}}),}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00013}00013       m\_buffer(NULL),}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00014}00014       m\_bufferSize(0),}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00015}00015       m\_paramCount(0)}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00016}00016 \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00017}00017 \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00019}\mbox{\hyperlink{class_cmd_parser_a5df6c3bc15c7d508ec449992f83b3bb0}{00019}} uint16\_t \mbox{\hyperlink{class_cmd_parser_a5df6c3bc15c7d508ec449992f83b3bb0}{CmdParser::parseCmd}}(uint8\_t *buffer, \textcolor{keywordtype}{size\_t} bufferSize)}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00020}00020 \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00021}00021     \textcolor{keywordtype}{bool} isString = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00022}00022 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00023}00023     \textcolor{comment}{// init param count}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00024}00024     m\_paramCount = 0;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00026}00026     \textcolor{comment}{// buffer is not okay}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00027}00027     \textcolor{keywordflow}{if} (buffer == NULL || bufferSize == 0 || buffer[0] == 0x00) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00028}00028         \textcolor{keywordflow}{return} \mbox{\hyperlink{_cmd_parser_8hpp_aa84115565fbd5d676715b34f14228b26}{CMDPARSER\_ERROR}};}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00029}00029     \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00031}00031     \textcolor{comment}{// init buffer}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00032}00032     m\_buffer     = buffer;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00033}00033     m\_bufferSize = bufferSize;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00036}00036     \textcolor{comment}{// Run Parser}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00037}00037     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < bufferSize; i++) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00039}00039         \textcolor{comment}{// end}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00040}00040         \textcolor{keywordflow}{if} (buffer[i] == 0x00 || m\_paramCount == 0xFFFE) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00041}00041             \textcolor{keywordflow}{if} (i > 0 \&\& buffer[i -\/ 1] != 0x00) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00042}00042                 m\_paramCount++;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00043}00043             \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00044}00044             \textcolor{keywordflow}{return} m\_paramCount;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00045}00045         \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00046}00046         \textcolor{comment}{// is string "{}xy zyx"{} / only the quote option is disabled}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00047}00047         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!m\_ignoreQuote \&\& buffer[i] == \mbox{\hyperlink{_cmd_parser_8hpp_a3d8e1545a55d983629b4b23d00b88c1c}{CMDPARSER\_CHAR\_DQ}}) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00048}00048             buffer[i] = 0x00;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00049}00049             isString  = !isString;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00050}00050         \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00051}00051         \textcolor{comment}{// replace seperator with '\(\backslash\)0'}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00052}00052         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!isString \&\& buffer[i] == m\_seperator) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00053}00053             buffer[i] = 0x00;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00054}00054         \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00055}00055         \textcolor{comment}{// replace = with '\(\backslash\)0' if KEY=Value is set}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00056}00056         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!isString \&\& m\_useKeyValue \&\& buffer[i] == \mbox{\hyperlink{_cmd_parser_8hpp_a293a7e2fc54bbfec5b0e8da10ec9a7fc}{CMDPARSER\_CHAR\_EQ}}) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00057}00057             buffer[i] = 0x00;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00058}00058         \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00059}00059 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00060}00060         \textcolor{comment}{// count}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00061}00061         \textcolor{keywordflow}{if} (i > 0 \&\& buffer[i] == 0x00 \&\& buffer[i -\/ 1] != 0x00) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00062}00062             m\_paramCount++;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00063}00063         \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00064}00064     \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00066}00066     \textcolor{keywordflow}{return} m\_paramCount;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00067}00067 \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00068}00068 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00069}\mbox{\hyperlink{class_cmd_parser_a49170df1a0052fa1fdb28235a488e7c6}{00069}} \textcolor{keywordtype}{char} *\mbox{\hyperlink{class_cmd_parser_a49170df1a0052fa1fdb28235a488e7c6}{CmdParser::getCmdParam}}(uint16\_t idx)}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00070}00070 \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00071}00071     uint16\_t count = 0;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00072}00072 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00073}00073     \textcolor{comment}{// idx bigger than exists param}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00074}00074     \textcolor{keywordflow}{if} (idx > m\_paramCount) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00075}00075         \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00076}00076     \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00077}00077 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00078}00078     \textcolor{comment}{// search hole cmd buffer}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00079}00079     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < m\_bufferSize; i++) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00080}00080 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00081}00081         \textcolor{comment}{// find next position}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00082}00082         \textcolor{keywordflow}{if} (i > 0 \&\& m\_buffer[i] == 0x00 \&\& m\_buffer[i -\/ 1] != 0x00) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00083}00083             count++;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00084}00084         \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00085}00085 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00086}00086         \textcolor{comment}{// found indx with next character}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00087}00087         \textcolor{keywordflow}{if} (count == idx \&\& m\_buffer[i] != 0x00) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00088}00088             \textcolor{keywordflow}{return} \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char} *\textcolor{keyword}{>}(\&m\_buffer[i]);}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00089}00089         \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00090}00090     \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00091}00091 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00092}00092     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00093}00093 \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00094}00094 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00095}00095 \textcolor{keywordtype}{char} *\mbox{\hyperlink{class_cmd_parser_a83141b1acb2583532801b2cddce225a5}{CmdParser::getValueFromKey}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *key, \textcolor{keywordtype}{bool} progmem)}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00096}00096 \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00097}00097     \textcolor{keywordtype}{bool} foundKey = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00098}00098 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00099}00099     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < m\_bufferSize; i++) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00100}00100 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00101}00101         \textcolor{comment}{// find data}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00102}00102         \textcolor{keywordflow}{if} (m\_buffer[i] == 0x00) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00103}00103             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00104}00104         \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00105}00105 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00106}00106         \textcolor{comment}{// find first element}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00107}00107         \textcolor{keywordflow}{if} (i == 0 || (m\_buffer[i -\/ 1] == 0x00 \&\& !foundKey)) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00108}00108             \textcolor{comment}{// if key in SRAM}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00109}00109             \textcolor{keywordflow}{if} (!progmem \&\&}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00110}00110                 strcasecmp(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char} *\textcolor{keyword}{>}(\&m\_buffer[i]), key) == 0) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00111}00111                 foundKey = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00112}00112             \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00113}00113             \textcolor{comment}{// if key in PROGMEM}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00114}00114             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (progmem \&\&}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00115}00115                      strcasecmp\_P(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char} *\textcolor{keyword}{>}(\&m\_buffer[i]),}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00116}00116                                   key) == 0) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00117}00117                 foundKey = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00118}00118             \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00119}00119         \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00120}00120         \textcolor{comment}{// Next element after found key is the value...}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00121}00121         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (m\_buffer[i -\/ 1] == 0x00) \{}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00122}00122             \textcolor{keywordflow}{return} \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{char} *\textcolor{keyword}{>}(\&m\_buffer[i]);}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00123}00123         \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00124}00124     \}}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00125}00125 }
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00126}00126     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{\Hypertarget{_cmd_parser_8cpp_source_l00127}00127 \}}

\end{DoxyCode}
